---
title: "Projekt_CV"
format:
  html:
    embed-resources: true
editor: visual
---

```{r}
library(tidyverse)
library(keras)
```

## Tematyka zadania

Celem tego projektu jest zbudowanie modelu konwolucyjnej sieci neuronowej służącej do klasyfikacji dzieł sztuki ze względu na gatunek (11 etykiet) oraz stylów malarskich (27 etykiet).

Zbiór danych którym posłużyliśmy się do trenowania modeli jest WikiArt zawierający ponad 84 tysiące różnych obrazów. Zbiór ten funkcjonuje w otwartym dostępie i jest darmowy do niekomercyjnego użytku.

## Klasyfikacja gatunku obrazu

Każdy z obrazów posiada etykietę wskazującą na gatunek obrazu:

-   0 - Malarstwo abstrakcyjne

-   1 - Pejzaż miejski

-   2 - Malarstwo rodzajowe

-   3 - Ilustracja

-   4 - Pejzaż

-   5 - Malarstwo nagie

-   6 - Portret

-   7 - Malarstwo religijne

-   8 - Szkic

-   9 - Martwa natura

-   10 - Gatunek nieznany

### Pierwszy projekt sieci

Pierwsza testowana przez nas architekutra sieci jest stosunkowo prosta ponieważ składa się jedynie z 4 warstw konwolucyjnych i max poolingowych ze stosunkowo niewielką ilością filtrów.

```{r}
model <- keras_model_sequential() %>%
  layer_conv_2d(filters = 32, kernel_size = c(3, 3), activation = "relu",
                input_shape = c(150, 150, 3)) %>%
  layer_max_pooling_2d(pool_size = c(2, 2)) %>%
  layer_conv_2d(filters = 64, kernel_size = c(3, 3), activation = "relu") %>%
  layer_max_pooling_2d(pool_size = c(2, 2)) %>%
  layer_conv_2d(filters = 128, kernel_size = c(3, 3), activation = "relu") %>%
  layer_max_pooling_2d(pool_size = c(2, 2)) %>%
  layer_conv_2d(filters = 128, kernel_size = c(3, 3), activation = "relu") %>%
  layer_max_pooling_2d(pool_size = c(2, 2)) %>%
  layer_flatten() %>%
  layer_dense(units = 512, activation = "relu") %>%
  layer_dense(units = 11, activation = "softmax")

model
```

Szkolenie w każdej epoce odbywało się na 3200 obrazkach oraz była przeprowadzana walidacja na 1600 obrazkach.

Funkcją optymalizującą był "Adam" oraz zastosowane były callbacki wcześniejszego zatrzymania po 5 epokach bez poprawy trafności na zbiorze walidacyjnym oraz na zapisywanie modelu po każdej epoce.

Przy tej strukturze sieć szkoliła się przez 28 epok kończąc proces uczenia przez zastosowanie callbacków ze względu na brak poprawy celności na zbiorze walidacyjnym.

![Pierwsza siec](plot_nn_1.png)

Widać że nastąpiło zjawisko przeuczenia. Najwyższą celnościa na zbiorze walidacyjnym było \~45%.

### Drugi projekt sieci

Druga architektura składa się z większej liczby warstw konwolucyjnych oraz większej ilości filtrów. Dodatkowo tym razem dodaliśmy warstwy dropout'ów w celu redukcji przeuczenia sieci.

```{r}
model <- keras_model_sequential() %>%
  layer_conv_2d(filters = 128, kernel_size = c(3, 3), activation = "relu",
                input_shape = c(150, 150, 3)) %>%
  layer_conv_2d(filters = 128, kernel_size = c(3, 3), activation = "relu") %>%
  layer_max_pooling_2d(pool_size = c(2, 2)) %>%
  layer_dropout(rate = 0.2) %>%
  layer_conv_2d(filters = 64, kernel_size = c(3, 3), activation = "relu") %>%
  layer_conv_2d(filters = 64, kernel_size = c(3, 3), activation = "relu") %>%
  layer_max_pooling_2d(pool_size = c(2, 2)) %>%
  layer_dropout(rate = 0.3) %>%
  layer_conv_2d(filters = 128, kernel_size = c(3, 3), activation = "relu") %>%
  layer_conv_2d(filters = 32, kernel_size = c(3, 3), activation = "relu") %>%
  layer_max_pooling_2d(pool_size = c(2, 2)) %>%
  layer_dropout(rate = 0.3) %>% 
  layer_flatten() %>%
  layer_dense(units = 256, activation = "relu") %>%
  layer_dense(units = 54, activation = "relu") %>%
  layer_dropout(rate = 0.5) %>%
  layer_dense(units = 11, activation = "softmax")

model
```

Uczenie tym razem odbywało się na 51 200 obrazach w epoce, a następnie model walidowany był na 12 800 obrazach.

Funkcją optymalizującą również był "Adam" oraz zastosowane były te same callbacki co przy wcześniejszej architekturze.

![Druga siec](plot_nn_2.png)

Niestety także i przy tej architekturze nastąpiło zjawisko przeuczenia (nawet szybciej niż w przypadku sieci poprzedniej) osiągając accuracy maksymalnie na poziomie 0.45.

### Trzeci projekt sieci

Tym razem zdecydowaliśmy się użyć wcześniej przeszkolonej sieci ResNet jako części konwolucyjnej. Ze względu na ograniczone zasoby obliczeniowe użyliśmy wersji ResNet50.

```{r}
conv_base <- application_resnet50(
  weights = "imagenet",
  include_top = F,
  input_shape = c(224,224,3)
)
```

```{r}
freeze_weights(conv_base)
unfreeze_weights(conv_base, from = "conv5_block3_2_conv")
```

Odmrażamy dwa ostatnie bloki konwolucyjne i normalizujące partię w celu dostrojenia sieci do naszego zadania.

```{r}
model <- keras_model_sequential() %>%
  conv_base %>%
  layer_flatten() %>%
  layer_dense(units = 512, activation = "relu") %>%
  layer_dense(units = 11, activation = "softmax")

model
```

Sieć uczona była na pełnym zbiorze treningowym przy użyciu optimizera "Adam" i tych samch callbacków co przy poprzednich architekturach.

![Trzecia siec](plot_nn_3.png)

W tym przypadku zjawisko przeuczenia nastąpiło nawet szybiciej niż przy poprzednich architekturach.

## Klasyfikacja stylu obrazu

-   0 - Abstrakcjonizm ekspresyjny

-   1 - Malowidło akcji

-   2 - Kubizm anlityczny

-   3 - Secesja

-   4 - Barok

-   5 Color_Field_Painting

-   6 Contemporary_Realism

-   7 - Kubizm

-   8 Early_Renaissance

-   9 - Ekspresjonizm

-   10 - Fowizm

-   11 - Późny renesans

-   12 - Impresjonizm

-   13 Mannerism_Late_Renaissance

-   14 - Minimalizm

-   15 Naive_Art_Primitivism

-   16 New_Realism

-   17 Northern_Renaissance

-   18 - Puentylizm

-   19 Pop_Art

-   20 Post_Impressionism

-   21 - Realizm

-   22 - Rokoko

-   23 Romanticism

-   24 - Symbolizm

-   25 Synthetic_Cubism

-   26 Ukiyo_e

-   27 - Styl nieznany
